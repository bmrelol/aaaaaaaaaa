<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix foreignobject { font-size: var(--mermaid-font-zoom); }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
  --mermaid-theme: night;
  --node-fill: #BDD5EA;
}

[lang='mermaid'] .label {
  color: #333;
}

/* CSS Document */

/** code highlight */

.cm-s-inner .cm-variable,
.cm-s-inner .cm-operator,
.cm-s-inner .cm-property {
    color: #b8bfc6;
}

.cm-s-inner .cm-keyword {
    color: #C88FD0;
}

.cm-s-inner .cm-tag {
    color: #7DF46A;
}

.cm-s-inner .cm-attribute {
    color: #7575E4;
}

.CodeMirror div.CodeMirror-cursor {
    border-left: 1px solid #b8bfc6;
    z-index: 3;
}

.cm-s-inner .cm-string {
    color: #D26B6B;
}

.cm-s-inner .cm-comment,
.cm-s-inner.cm-comment {
    color: #DA924A;
}

.cm-s-inner .cm-header,
.cm-s-inner .cm-def,
.cm-s-inner.cm-header,
.cm-s-inner.cm-def {
    color: #8d8df0;
}

.cm-s-inner .cm-quote,
.cm-s-inner.cm-quote {
    color: #57ac57;
}

.cm-s-inner .cm-hr {
    color: #d8d5d5;
}

.cm-s-inner .cm-link {
    color: #d3d3ef;
}

.cm-s-inner .cm-negative {
    color: #d95050;
}

.cm-s-inner .cm-positive {
    color: #50e650;
}

.cm-s-inner .cm-string-2 {
    color: #f50;
}

.cm-s-inner .cm-meta,
.cm-s-inner .cm-qualifier {
    color: #b7b3b3;
}

.cm-s-inner .cm-builtin {
    color: #f3b3f8;
}

.cm-s-inner .cm-bracket {
    color: #997;
}

.cm-s-inner .cm-atom,
.cm-s-inner.cm-atom {
    color: #84B6CB;
}

.cm-s-inner .cm-number {
    color: #64AB8F;
}

.cm-s-inner .cm-variable {
    color: #b8bfc6;
}

.cm-s-inner .cm-variable-2 {
    color: #9FBAD5;
}

.cm-s-inner .cm-variable-3 {
    color: #1cc685;
}

.CodeMirror-selectedtext,
.CodeMirror-selected {
    background: #4a89dc;
    color: #fff !important;
    text-shadow: none;
}

.CodeMirror-gutters {
    border-right: none;
}

/* CSS Document */

/** markdown source **/
.cm-s-typora-default .cm-header, 
.cm-s-typora-default .cm-property
{
    color: #cebcca;
}

.CodeMirror.cm-s-typora-default div.CodeMirror-cursor{
    border-left: 3px solid #b8bfc6;
}

.cm-s-typora-default .cm-comment {
    color: #9FB1FF;
}

.cm-s-typora-default .cm-string {
    color: #A7A7D9
}

.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number {
    color: #848695;
    font-style: italic;
}

.cm-s-typora-default .cm-link {
    color: #95B94B;
}

.cm-s-typora-default .CodeMirror-activeline-background {
    background: rgba(51, 51, 51, 0.72);
}

.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code {
	color: #8aa1e1;
}@import "";
@import "";
@import "";

:root {
    --bg-color:  #363B40;
    --side-bar-bg-color: #2E3033;
    --text-color: #b8bfc6;

    --select-text-bg-color:#4a89dc;

    --item-hover-bg-color: #0a0d16;
    --control-text-color: #b7b7b7;
    --control-text-hover-color: #eee;
    --window-border: 1px solid #555;

    --active-file-bg-color: rgb(34, 34, 34);
    --active-file-border-color: #8d8df0;

    --primary-color: #a3d5fe;

    --active-file-text-color: white;
    --item-hover-bg-color: #70717d;
    --item-hover-text-color: white;
    --primary-color: #6dc1e7;

    --rawblock-edit-panel-bd: #333;

    --search-select-bg-color: #428bca;
}

html {
    font-size: 16px;
}

html,
body {
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    background: #363B40;
    background: var(--bg-color);
    fill: currentColor;
    line-height: 1.625rem;
}

#write {
    max-width: 914px;
}


@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

html,
body,
button,
input,
select,
textarea,
div.code-tooltip-content {
    color: #b8bfc6;
    border-color: transparent;
}

div.code-tooltip,
.md-hover-tip .md-arrow:after {
    background: #333;
}

.popover.bottom > .arrow:after {
    border-bottom-color: #333;
}

html,
body,
button,
input,
select,
textarea {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

hr {
    height: 2px;
    border: 0;
    margin: 24px 0 !important;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: "Lucida Grande", "Corbel", sans-serif;
    font-weight: normal;
    clear: both;
    -ms-word-wrap: break-word;
    word-wrap: break-word;
    margin: 0;
    padding: 0;
    color: #DEDEDE
}

h1 {
    font-size: 2.5rem;
    /* 36px */
    line-height: 2.75rem;
    /* 40px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1.5px;
}

h2 {
    font-size: 1.63rem;
    /* 24px */
    line-height: 1.875rem;
    /* 30px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h3 {
    font-size: 1.17rem;
    /* 18px */
    line-height: 1.5rem;
    /* 24px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h4 {
    font-size: 1.12rem;
    /* 16px */
    line-height: 1.375rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    color: white;
}

h5 {
    font-size: 0.97rem;
    /* 16px */
    line-height: 1.25rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    font-weight: bold;
}

h6 {
    font-size: 0.93rem;
    /* 16px */
    line-height: 1rem;
    /* 16px */
    margin-bottom: 0.75rem;
    color: white;
}

@media (min-width: 980px) {
    h3.md-focus:before,
    h4.md-focus:before,
    h5.md-focus:before,
    h6.md-focus:before {
        color: #ddd;
        border: 1px solid #ddd;
        border-radius: 3px;
        position: absolute;
        left: -1.642857143rem;
        top: .357142857rem;
        float: left;
        font-size: 9px;
        padding-left: 2px;
        padding-right: 2px;
        vertical-align: bottom;
        font-weight: normal;
        line-height: normal;
    }

    h3.md-focus:before {
        content: 'h3';
    }

    h4.md-focus:before {
        content: 'h4';
    }

    h5.md-focus:before {
        content: 'h5';
        top: 0px;
    }

    h6.md-focus:before {
        content: 'h6';
        top: 0px;
    }
}

a {
    text-decoration: none;
    outline: 0;
}

a:hover {
    outline: 0;
}

a:focus {
    outline: thin dotted;
}

sup.md-footnote {
    background-color: #555;
    color: #ddd;
}

p {
    -ms-word-wrap: break-word;
    word-wrap: break-word;
}

p,
ul,
dd,
ol,
hr,
address,
pre,
table,
iframe,
.wp-caption,
.wp-audio-shortcode,
.wp-video-shortcode {
    margin-top: 0;
    margin-bottom: 1.5rem;
    /* 24px */
}

audio:not([controls]) {
    display: none;
}

[hidden] {
    display: none;
}

::-moz-selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

*.in-text-selection,
::selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

ul,
ol {
    padding: 0 0 0 1.875rem;
    /* 30px */
}

ul {
    list-style: square;
}

ol {
    list-style: decimal;
}

ul ul,
ol ol,
ul ol,
ol ul {
    margin: 0;
}

b,
th,
dt,
strong {
    font-weight: bold;
}

i,
em,
dfn,
cite {
    font-style: italic;
}

blockquote {
    padding-left: 1.875rem;
    margin: 0 0 1.875rem 1.875rem;
    border-left: solid 2px #474d54;
    padding-left: 30px;
    margin-top: 35px;
}

pre,
code,
kbd,
tt,
var {
    font-size: 0.875rem;
    font-family: Monaco, Consolas, "Andale Mono", "DejaVu Sans Mono", monospace;
}

code,
tt,
var {
    background: rgba(0, 0, 0, 0.05);
}

kbd {
    padding: 2px 4px;
    font-size: 90%;
    color: #fff;
    background-color: #333;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.25);
}

pre.md-fences {
    padding: 10px 10px 10px 30px;
    margin-bottom: 20px;
    background: #333;
}

.CodeMirror-gutters {
    background: #333;
    border-right: 1px solid transparent;
}

.enable-diagrams pre.md-fences[lang="sequence"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="flow"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="mermaid"] .code-tooltip {
    bottom: -2.2em;
    right: 4px;
}

code,
kbd,
tt,
var {
    padding: 2px 5px;
}

table {
    max-width: 100%;
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0;
}

th,
td {
    padding: 5px 10px;
    vertical-align: top;
}

a {
    -webkit-transition: all .2s ease-in-out;
    transition: all .2s ease-in-out;
}

hr {
    background: #474d54;
    /* variable */
}

h1 {
    margin-top: 2em;
}

a {
    color: #e0e0e0;
    text-decoration: underline;
}

a:hover {
    color: #fff;
}

.md-inline-math script {
    color: #81b1db;
}

b,
th,
dt,
strong {
    color: #DEDEDE;
    /* variable */
}

mark {
    background: #D3D40E;
}

blockquote {
    color: #9DA2A6;
}

table a {
    color: #DEDEDE;
    /* variable */
}

th,
td {
    border: solid 1px #474d54;
    /* variable */
}

.task-list {
    padding-left: 0;
}

.md-task-list-item {
    padding-left: 1.25rem;
}

.md-task-list-item > input {
    top: auto;
}

.md-task-list-item > input:before {
    content: "";
    display: inline-block;
    width: 0.875rem;
    height: 0.875rem;
    vertical-align: middle;
    text-align: center;
    border: 1px solid #b8bfc6;
    background-color: #363B40;
    margin-top: -0.4rem;
}

.md-task-list-item > input:checked:before,
.md-task-list-item > input[checked]:before {
    content: '\221A';
    /*◘*/
    font-size: 0.625rem;
    line-height: 0.625rem;
    color: #DEDEDE;
}

/** quick open **/
.auto-suggest-container {
    border: 0px;
    background-color: #525C65;
}

#typora-quick-open {
    background-color: #525C65;
}

#typora-quick-open input{
    background-color: #525C65;
    border: 0;
    border-bottom: 1px solid grey;
}

.typora-quick-open-item {
    background-color: inherit;
    color: inherit;
}

.typora-quick-open-item.active,
.typora-quick-open-item:hover {
    background-color: #4D8BDB;
    color: white;
}

.typora-quick-open-item:hover {
    background-color: rgba(77, 139, 219, 0.8);
}

.typora-search-spinner > div {
  background-color: #fff;
}

#write pre.md-meta-block {
    border-bottom: 1px dashed #ccc;
    background: transparent;
    padding-bottom: 0.6em;
    line-height: 1.6em;
}

.btn,
.btn .btn-default {
    background: transparent;
    color: #b8bfc6;
}

.ty-table-edit {
    border-top: 1px solid gray;
    background-color: #363B40;
}

.popover-title {
    background: transparent;
}

.md-image>.md-meta {
    color: #BBBBBB;
    background: transparent;
}

.md-expand.md-image>.md-meta {
    color: #DDD;
}

#write>h3:before,
#write>h4:before,
#write>h5:before,
#write>h6:before {
    border: none;
    border-radius: 0px;
    color: #888;
    text-decoration: underline;
    left: -1.4rem;
    top: 0.2rem;
}

#write>h3.md-focus:before {
    top: 2px;
}

#write>h4.md-focus:before {
    top: 2px;
}

.md-toc-item {
    color: #A8C2DC;
}

#write div.md-toc-tooltip {
    background-color: #363B40;
}

.dropdown-menu .btn:hover,
.dropdown-menu .btn:focus,
.md-toc .btn:hover,
.md-toc .btn:focus {
    color: white;
    background: black;
}

#toc-dropmenu {
    background: rgba(50, 54, 59, 0.93);
    border: 1px solid rgba(253, 253, 253, 0.15);
}

#toc-dropmenu .divider {
    background-color: #9b9b9b;
}

.outline-expander:before {
    top: 2px;
}

#typora-sidebar {
    box-shadow: none;
    border-right: 1px dashed;
    border-right: none;
}

.sidebar-tabs {
    border-bottom:0;
}

#typora-sidebar:hover .outline-title-wrapper {
    border-left: 1px dashed;
}

.outline-title-wrapper .btn {
    color: inherit;
}

.outline-item:hover {
    border-color: #363B40;
    background-color: #363B40;
    color: white;
}

h1.md-focus .md-attr,
h2.md-focus .md-attr,
h3.md-focus .md-attr,
h4.md-focus .md-attr,
h5.md-focus .md-attr,
h6.md-focus .md-attr,
.md-header-span .md-attr {
    color: #8C8E92;
    display: inline;
}

.md-comment {
    color: #5a95e3;
    opacity: 1;
}

.md-inline-math svg {
    color: #b8bfc6;
}

#math-inline-preview .md-arrow:after {
    background: black;
}

.modal-content {
    background: var(--bg-color);
    border: 0;
}

.modal-title {
    font-size: 1.5em;
}

.modal-content input {
    background-color: rgba(26, 21, 21, 0.51);
    color: white;
}

.modal-content .input-group-addon {
    color: white;
}

.modal-backdrop {
    background-color: rgba(174, 174, 174, 0.7);
}

.modal-content .btn-primary {
    border-color: var(--primary-color);
}

.md-table-resize-popover {
    background-color: #333;
}

.form-inline .input-group .input-group-addon {
    color: white;
}

#md-searchpanel {
    border-bottom: 1px dashed grey;
}

/** UI for electron */

.context-menu,
#spell-check-panel,
#footer-word-count-info {
    background-color: #42464A;
}

.context-menu.dropdown-menu .divider,
.dropdown-menu .divider {
    background-color: #777777;
}

footer {
    color: inherit;
}

@media (max-width: 1000px) {
    footer {
        border-top: none;
    }
    footer:hover {
        color: inherit;
    }
}

#file-info-file-path .file-info-field-value:hover {
    background-color: #555;
    color: #dedede;
}

.megamenu-content,
.megamenu-opened header {
    background: var(--bg-color);
}

.megamenu-menu-panel h2,
.megamenu-menu-panel h1,
.long-btn {
    color: inherit;
}

.megamenu-menu-panel input[type='text'] {
    background: inherit;
    border: 0;
    border-bottom: 1px solid;
}

#recent-file-panel-action-btn {
    background: inherit;
    border: 1px grey solid;
}

.megamenu-menu-panel .dropdown-menu > li > a {
    color: inherit;
    background-color: #2F353A;
    text-decoration: none;
}

.megamenu-menu-panel table td:nth-child(1) {
    color: inherit;
    font-weight: bold;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(1) {
    color: white;
}

.modal-footer .btn-default, 
.modal-footer .btn-primary,
.modal-footer .btn-default:not(:hover) {
    border: 1px solid;
    border-color: transparent;
}

.btn-primary {
    color: white;
}

.btn-default:hover, .btn-default:focus, .btn-default.focus, .btn-default:active, .btn-default.active, .open > .dropdown-toggle.btn-default {
    color: white;
    border: 1px solid #ddd;
    background-color: inherit;
}

.modal-header {
    border-bottom: 0;
}

.modal-footer {
    border-top: 0;
}

#recent-file-panel tbody tr:nth-child(2n-1) {
    background-color: transparent !important;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(2) {
    color: inherit;
}

.megamenu-menu-panel .btn {
    border: 1px solid #eee;
    background: transparent;
}

.mouse-hover .toolbar-icon.btn:hover,
#w-full.mouse-hover,
#w-pin.mouse-hover {
    background-color: inherit;
}

.typora-node::-webkit-scrollbar {
    width: 5px;
}

.typora-node::-webkit-scrollbar-thumb:vertical {
    background: rgba(250, 250, 250, 0.3);
}

.typora-node::-webkit-scrollbar-thumb:vertical:active {
    background: rgba(250, 250, 250, 0.5);
}

#w-unpin {
    background-color: #4182c4;
}

#top-titlebar, #top-titlebar * {
    color: var(--item-hover-text-color);
}

.typora-sourceview-on #toggle-sourceview-btn,
#footer-word-count:hover,
.ty-show-word-count #footer-word-count {
    background: #333333;
}

#toggle-sourceview-btn:hover {
    color: #eee;
    background: #333333;
}

/** focus mode */
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) * {
    color: #686868 !important;
}

.on-focus-mode .md-end-block:not(.md-focus) img,
.on-focus-mode .md-task-list-item:not(.md-focus-container)>input {
    opacity: #686868 !important;
}

.on-focus-mode li[cid]:not(.md-focus-container){
    color: #686868;
}

.on-focus-mode .md-fences.md-focus .CodeMirror-code>*:not(.CodeMirror-activeline) *,
.on-focus-mode .CodeMirror.cm-s-inner:not(.CodeMirror-focused) * {
    color: #686868 !important;
}

.on-focus-mode .md-focus,
.on-focus-mode .md-focus-container {
    color: #fff;
}

.on-focus-mode #typora-source .CodeMirror-code>*:not(.CodeMirror-activeline) * {
    color: #686868 !important;
}


/*diagrams*/
#write .md-focus .md-diagram-panel {
    border: 1px solid #ddd;
    margin-left: -1px;
    width: calc(100% + 2px);
}

/*diagrams*/
#write .md-focus.md-fences-with-lineno .md-diagram-panel {
    margin-left: auto;
}

.md-diagram-panel-error {
    color: #f1908e;
}

.active-tab-files #info-panel-tab-file,
.active-tab-files #info-panel-tab-file:hover,
.active-tab-outline #info-panel-tab-outline,
.active-tab-outline #info-panel-tab-outline:hover {
    color: #eee;
}

.sidebar-footer-item:hover,
.footer-item:hover {
    background: inherit;
    color: white;
}

.ty-side-sort-btn.active,
.ty-side-sort-btn:hover,
.selected-folder-menu-item a:after {
    color: white;
}

#sidebar-files-menu {
    border:solid 1px;
    box-shadow: 4px 4px 20px rgba(0, 0, 0, 0.79);
    background-color: var(--bg-color);
}

.file-list-item {
    border-bottom:none;
}

.file-list-item-summary {
    opacity: 1;
}

.file-list-item.active:first-child {
    border-top: none;
}

.file-node-background {
    height: 32px;
}

.file-library-node.active>.file-node-content,
.file-list-item.active {
    color: white;
    color: var(--active-file-text-color);
}

.file-library-node.active>.file-node-background{
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}
.file-list-item.active {
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}

#ty-tooltip {
    background-color: black;
    color: #eee;
}

.md-task-list-item>input {
    margin-left: -1.3em;
    margin-top: 0.3rem;
    -webkit-appearance: none;
}

.md-mathjax-midline {
    background-color: #57616b;
    border-bottom: none;
}

footer.ty-footer {
    border-color: #656565;
}

.ty-preferences .btn-default {
    background: transparent;
}
.ty-preferences .btn-default:hover {
    background: #57616b;
}

.ty-preferences select {
    border: 1px solid #989698;
    height: 21px;
}

.ty-preferences .nav-group-item.active {
    background: var(--item-hover-bg-color);
}

.ty-preferences input[type="search"] {
    border-color: #333;
    background: #333;
    line-height: 22px;
    border-radius: 6px;
    color: white;
}

.ty-preferences input[type="search"]:focus {
    box-shadow: none;
}

[data-is-directory="true"] .file-node-content {
    margin-bottom: 0;
}

.file-node-title {
    line-height: 22px;
}

.html-for-mac .file-node-open-state, .html-for-mac .file-node-icon {
    line-height: 26px;
}

::-webkit-scrollbar-thumb {
    background: rgba(230, 230, 230, 0.30);
}

::-webkit-scrollbar-thumb:active {
    background: rgba(230, 230, 230, 0.50);
}

#typora-sidebar:hover div.sidebar-content-content::-webkit-scrollbar-thumb:horizontal {
    background: rgba(230, 230, 230, 0.30);
}

.nav-group-item:active {
    background-color: #474d54;
}

.md-search-hit {
    background: rgba(199, 140, 60, 0.81);
    color: #eee;
}

.md-search-hit * {
    color: #eee;
}

#md-searchpanel input {
    color: white;
}

.export-detail,
.export-item.active,
.export-items-list-control {
    background: #d6d6d4
}

.modal-backdrop.in {
    opacity: 1;
    backdrop-filter: blur(1px);
}

 :root {--mermaid-font-zoom:1.5em ;} 
</style>
<title>Brute Ratel analysis</title>
</head>
<body class='typora-export os-windows'>
<div id='write'  class=''><h1><a name="brute-ratel---scandinavian-defence" class="md-header-anchor"></a><span>Brute Ratel - Scandinavian Defence</span></h1><h2><a name="disclaimer" class="md-header-anchor"></a><span>Disclaimer</span></h2><p><span>The opinions expressed in this post is that of the author and absolutely also that of the presenters&#39; employers, parents, pets, governments, mentors, siblings, and the Council of the City of Eugene, Oregon.</span></p><h2><a name="introduction" class="md-header-anchor"></a><span>Introduction</span></h2><p><span>Brute Ratel is a so-called &quot;red team&quot; malware created by some Twitter malware developer who claims to be an ex-EDR engineer. Right now, it is most known for being abused by various ransomware gangs and the author lying about that despite extensive proof otherwise. The reverse engineering project was instigated by these reports of abuse by RaaS. More specifically, abuse by Blackcat / ALPHV affiliates were reported by Sophos in private circles on July 1st 2022.</span></p><p><span>The version being reverse engineered is called &quot;Scandinavian Defence&quot; - the version most commonly abused by TAs. However, other versions (up to the latest as of the time of writing, which is 27/01/2023) are available to this author, and might be discussed at a later date should time permit. However, the work done on the current version is enough to give an in-depth understanding of the way Brute Ratel was designed, and the author&#39;s capabilities and lack thereof.</span></p><p><span>The payload was generated using the same leaked builder that is used extensively by threat actors. The generated format is a blob of position independent code, which takes the following form.</span></p><p><img src="img\overview.png" referrerpolicy="no-referrer" alt="Overview"></p><p>&nbsp;</p><h2><a name="loader" class="md-header-anchor"></a><span>Loader</span></h2><p><span>The generated loader is typically a shellcode (which is sometimes later stuffed into a PE file). The shellcode can be decompiled as:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">unsigned</span> <span class="cm-variable-3">char</span> <span class="cm-variable">base64_config</span>[] <span class="cm-operator">=</span> {};</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">unsigned</span> <span class="cm-variable-3">char</span> <span class="cm-variable">encrypted_payload_followed_by_key</span>[] <span class="cm-operator">=</span> {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable-3">*</span><span class="cm-variable">base64_config_dup</span> <span class="cm-operator">=</span> <span class="cm-variable">alloc_clone</span>(<span class="cm-variable">base64_config</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">base64_config</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable-3">*</span><span class="cm-variable">encrypted_payload_dup</span> <span class="cm-operator">=</span> <span class="cm-variable">alloc_clone</span>(<span class="cm-variable">encrypted_payload_followed_by_key</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">encrypted_payload_followed_by_key</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">decrypt_and_run</span>(<span class="cm-variable">encrypted_payload_dup</span>, <span class="cm-variable">base64_config_dup</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></pre><p><span>The function decrypt_and_run is a generic PE mapper that passes a context structure to the mapped PE containing the key. A RC4 key is stored in the last 8 bytes of encrypted_payload_followed_by_key, this is used for both payload decryption and config decryption.</span></p><p><span>It should be noted that the configuration and encrypted payload are initialised on the stack - that is, with a series of mov/push. The reasons for this are likely incompetence from the developer who doesn&#39;t what RIP-relative addressing is.</span></p><h2><a name="inner-payload" class="md-header-anchor"></a><span>Inner payload</span></h2><h4><a name="inner-payload-initialisation" class="md-header-anchor"></a><span>Inner payload initialisation</span></h4><p><span>The inner payload is a &quot;DLL&quot; file whose entrypoint takes a single pointer to a context structure provided by the outer layer. This context structure takes the following form:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">struct</span> <span class="cm-def">__unaligned</span> <span class="cm-def">__declspec</span>(<span class="cm-variable">align</span>(<span class="cm-number">1</span>)) <span class="cm-variable">BR_LOADER_CONTEXT</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">config_base64</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">HANDLE</span> <span class="cm-variable">event_initialisation_finished</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">config_key</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">loader_unmap_ptr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">loader_clear1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">loader_clear2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="display: none; height: 234px;"></div></div></div></pre><p><span>The loader_unmap_ptr and loader_clear1/loader_clear2 are regions that the inner payload would clear and free upon initialisation, this is to clean up traces of the outer layer.</span></p><p><span>Next, various APIs are initialised and syscall IDs grabbed. They are generic - nothing special to talk about there.</span></p><p><span>The config is decrypted and stored into the context. This is done by base64 decoding and then RC4-ing with the key appended to the encrypted payload mentioned earlier. The format is as follows.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sleep_callback_mode|sleep_time|sleep_jitter|doh_servers|doh_c2s|doh_fake_ip1|doh_fake_ip2|prepend_data|append_data|config_flag_unknown2_maybe_exit_if_disconnect |config_flag_use_tls|http_hosts_array|http_port|user_agent|handshake_cds_auth|comms_crypto_key|path|config_https_headers|watermark maybe?</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="display: none; height: 78px;"></div></div></div></pre><p><span>Each format entry is separated by |, with some supporting arrays that are separated by the character </span><code>,</code><span> such as the http host array etc. An example decoded config would be:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">0|60|40|||||cHJlcGVuZGVkIGRhdGEgd293|YXBwZW5kZWQgZGF0YSB3b3c=|0|1|rotational_host.com|443|shitty useragent here|G8DQGVPJOPERI3OA|DEEP9FV3309VB55C|/lsdjfioasjdfiosdajo.php|i fucking hate malware: i fucking hate malware|726b070f05876a8daa8269d69bcb52c321aa2d689f0bcd3033ad93aa0419b08c```</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="display: none; height: 78px;"></div></div></div></pre><h4><a name="payload-communication-encoding-layer" class="md-header-anchor"></a><span>Payload communication (encoding layer)</span></h4><p><span>Communication happens over either DoH or HTTP(s). Data is encrypted with a block cipher with the key specified in the config.</span></p><p><span>HTTPs traffic is just data POST with appended/prepended data alongside custom headers, typical C2 stuff, nothing special.</span></p><p><span>DNS communication is spread over a series of A/TX requests - A for sending and TX for receiving.</span>
<span>For requests of size less than 64 bytes the sequences is as follows:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">A: random.send_length.transaction_id.host</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">A: random.send_data.transaction_id.host</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">do</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>TX: random.transaction_id.host -&gt; response</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} while (response.type != A &amp;&amp; response.type != config_ip_termination)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p><span>For requests of size larger than 64 bytes the sequence is as follows:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">A: random.send_length.transaction_id.host</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>A: random.chunk.transaction_id.host</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>where chunk is 64 bytes chunks of the send data, with its content reversed</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>TX: random.transaction_id.host -&gt; response</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} while (response.type != A &amp;&amp; response.type != config_ip_termination)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 212px;"></div><div class="CodeMirror-gutters" style="display: none; height: 212px;"></div></div></div></pre><p><span>All data is encrypted with an AES variant, more details will follow.</span></p><h4><a name="payload-communication-internal-layer" class="md-header-anchor"></a><span>Payload communication (internal layer)</span></h4><p><span>The communication starts with the following handshake.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  "cds": {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "auth": "config.handshake_cds_auth"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  "mtdt": {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "h_name": "hostname",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "wver": "{system_architecture}",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "arch": "x64",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "bld": "build_number",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "p_name": "module_file_name",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "uid": "username_str [asterisk appended if elevated]",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "pid": "{current_pid}",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "tid": "current_tid"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 390px;"></div><div class="CodeMirror-gutters" style="display: none; height: 390px;"></div></div></div></pre><p><span>Server response: The server response is a base64-encoded string, the decoded variant of which is used for the &quot;auth&quot; parameter of further requests.</span></p><p><span>After this initial handshake, Brute Ratel loops and sends the check-in request.</span></p><p><span>Check-in:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  "cds": {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "auth": "handshake_response"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  //optional</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  "dt": {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "chkin": "pending commands"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 260px;"></div><div class="CodeMirror-gutters" style="display: none; height: 260px;"></div></div></div></pre><p><span>Server responses contain base64 encoded and encrypted commands. Commands are separated with &quot;,&quot; and are each base64 encoded internally. A max of 50 concurrent commands are supported at a time.</span></p><h3><a name="cryptography" class="md-header-anchor"></a><span>Cryptography</span></h3><p><span>The cryptography used for encrypting communication is a variant of the AES block cipher. The table used is the exact same (though incremented by 1 at rest and &quot;decoded&quot; by subtracting 1 from every entry in the table at runtime). However, the operations are slightly different. An abridged decompilation follows. It should be noted that this author is not an expert at cryptography, and function names designated here might be inaccurate.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable">__usercall</span> <span class="cm-variable">__spoils</span><span class="cm-operator">&lt;</span><span class="cm-variable">rax</span>,<span class="cm-variable">rdx</span>,<span class="cm-variable">r8</span><span class="cm-operator">&gt;</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">sub_bytes</span>(<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">buffer@</span><span class="cm-operator">&lt;</span><span class="cm-variable">rcx</span><span class="cm-operator">&gt;</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">i</span>; <span class="cm-comment">// rax</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> ( <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>; <span class="cm-variable">i</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">buffer</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">sbox</span>[<span class="cm-variable">buffer</span>[<span class="cm-variable">i</span>]];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable">__usercall</span> <span class="cm-variable">__spoils</span><span class="cm-operator">&lt;</span><span class="cm-variable">rax</span>,<span class="cm-variable">rdx</span><span class="cm-operator">&gt;</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">shuffle_chunk_enc</span>(<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">a1@</span><span class="cm-operator">&lt;</span><span class="cm-variable">rcx</span><span class="cm-operator">&gt;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">i</span>; <span class="cm-comment">// rax</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">v2</span>[<span class="cm-number">24</span>]; <span class="cm-comment">// [rsp+0h] [rbp-18h]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">a1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">5</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">2</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">10</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">3</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">15</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">4</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">4</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">5</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">9</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">6</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">14</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">7</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">3</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">8</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">8</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">9</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">13</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">10</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">2</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">11</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">7</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">12</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">12</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">13</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">14</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">6</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">15</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">11</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> ( <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>; <span class="cm-variable">i</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">a1</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">v2</span>[<span class="cm-variable">i</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable">__usercall</span> <span class="cm-variable">__spoils</span><span class="cm-operator">&lt;</span><span class="cm-variable">r8</span>,<span class="cm-variable">rax</span>,<span class="cm-variable">r9</span>,<span class="cm-variable">r10</span><span class="cm-operator">&gt;</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">mix_sub_columns</span>(<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">a1@</span><span class="cm-operator">&lt;</span><span class="cm-variable">rcx</span><span class="cm-operator">&gt;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v1</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">2</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">a1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v3</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">3</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v4</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v5</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">a1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v6</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v4</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v2</span>] <span class="cm-variable">^</span> <span class="cm-variable">v3</span> <span class="cm-variable">^</span> <span class="cm-variable">v1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v7</span> <span class="cm-operator">=</span> <span class="cm-variable">v6</span> <span class="cm-variable">^</span> <span class="cm-variable">v5</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v8</span> <span class="cm-operator">=</span> <span class="cm-variable">v1</span> <span class="cm-variable">^</span> <span class="cm-variable">v6</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v9</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v4</span>] <span class="cm-variable">^</span> <span class="cm-variable">v3</span> <span class="cm-variable">^</span> <span class="cm-variable">v2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v10</span> <span class="cm-operator">=</span> <span class="cm-variable">v1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v11</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">6</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v12</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v10</span>] <span class="cm-variable">^</span> <span class="cm-variable">v9</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v13</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v10</span>] <span class="cm-variable">^</span> <span class="cm-variable">v7</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v14</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v2</span>] <span class="cm-variable">^</span> <span class="cm-variable">v8</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v15</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">5</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">v12</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v16</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v3</span>] <span class="cm-variable">^</span> <span class="cm-variable">v14</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v17</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">4</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v18</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v3</span>] <span class="cm-variable">^</span> <span class="cm-variable">v13</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v19</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">7</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">3</span>] <span class="cm-operator">=</span> <span class="cm-variable">v16</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">2</span>] <span class="cm-operator">=</span> <span class="cm-variable">v18</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">4</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v15</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v17</span>] <span class="cm-variable">^</span> <span class="cm-variable">v19</span> <span class="cm-variable">^</span> <span class="cm-variable">v11</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v20</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v11</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v15</span>] <span class="cm-variable">^</span> <span class="cm-variable">v19</span> <span class="cm-variable">^</span> <span class="cm-variable">v17</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v21</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v11</span>] <span class="cm-variable">^</span> <span class="cm-variable">v15</span> <span class="cm-variable">^</span> <span class="cm-variable">v17</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">7</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v19</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v17</span>] <span class="cm-variable">^</span> <span class="cm-variable">v11</span> <span class="cm-variable">^</span> <span class="cm-variable">v15</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v22</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v19</span>] <span class="cm-variable">^</span> <span class="cm-variable">v21</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">5</span>] <span class="cm-operator">=</span> <span class="cm-variable">v20</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">6</span>] <span class="cm-operator">=</span> <span class="cm-variable">v22</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v23</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">8</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v24</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">10</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v25</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">11</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v26</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">9</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v27</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">8</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v28</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">9</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">8</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v26</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v23</span>] <span class="cm-variable">^</span> <span class="cm-variable">v25</span> <span class="cm-variable">^</span> <span class="cm-variable">v24</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v29</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v24</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v26</span>] <span class="cm-variable">^</span> <span class="cm-variable">v25</span> <span class="cm-variable">^</span> <span class="cm-variable">v23</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v30</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v25</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v24</span>] <span class="cm-variable">^</span> <span class="cm-variable">v28</span> <span class="cm-variable">^</span> <span class="cm-variable">v27</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v31</span> <span class="cm-operator">=</span> <span class="cm-variable">v24</span> <span class="cm-variable">^</span> <span class="cm-variable">v28</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">14</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">9</span>] <span class="cm-operator">=</span> <span class="cm-variable">v29</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v33</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">13</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v34</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v23</span>] <span class="cm-variable">^</span> <span class="cm-variable">v31</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">10</span>] <span class="cm-operator">=</span> <span class="cm-variable">v30</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v35</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">12</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v36</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v25</span>] <span class="cm-variable">^</span> <span class="cm-variable">v34</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v37</span> <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">15</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">11</span>] <span class="cm-operator">=</span> <span class="cm-variable">v36</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">12</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v33</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v35</span>] <span class="cm-variable">^</span> <span class="cm-variable">v37</span> <span class="cm-variable">^</span> <span class="cm-variable">v32</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v38</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v32</span>] <span class="cm-variable">^</span> <span class="cm-variable">v33</span> <span class="cm-variable">^</span> <span class="cm-variable">v35</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v39</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v32</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v33</span>] <span class="cm-variable">^</span> <span class="cm-variable">v37</span> <span class="cm-variable">^</span> <span class="cm-variable">v35</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">15</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime2</span>[<span class="cm-variable">v37</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v35</span>] <span class="cm-variable">^</span> <span class="cm-variable">v32</span> <span class="cm-variable">^</span> <span class="cm-variable">v33</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v40</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v41</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime3</span>[<span class="cm-variable">v37</span>] <span class="cm-variable">^</span> <span class="cm-variable">v38</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">13</span>] <span class="cm-operator">=</span> <span class="cm-variable">v39</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v42</span>[<span class="cm-number">14</span>] <span class="cm-operator">=</span> <span class="cm-variable">v41</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">do</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">a1</span>[<span class="cm-variable">v40</span>] <span class="cm-operator">=</span> <span class="cm-variable">v42</span>[<span class="cm-variable">v40</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">++</span><span class="cm-variable">v40</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">while</span> ( <span class="cm-variable">v40</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span> );</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">__int64</span> <span class="cm-variable">__fastcall</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">block_crypt_cbc</span>(<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">chunk_enc</span>, <span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">iv</span>, <span class="cm-variable">BR_CRYPT_BLOCKSTATE</span> <span class="cm-operator">*</span><span class="cm-variable">state</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">i</span>; <span class="cm-comment">// rax</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">uint8_t</span> <span class="cm-variable">v5</span>; <span class="cm-comment">// r8</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">ptr_state</span>; <span class="cm-comment">// rsi</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">state_end</span>; <span class="cm-comment">// r12</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">ptr_state_</span>; <span class="cm-comment">// rdx</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">result</span>; <span class="cm-comment">// rax</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">uint8_t</span> <span class="cm-variable">local_chunk</span>[<span class="cm-number">16</span>]; <span class="cm-comment">// [rsp+20h] [rbp-28h] BYREF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> ( <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>; <span class="cm-variable">i</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span>; <span class="cm-variable">local_chunk</span>[<span class="cm-variable">i</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">v5</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">v5</span> <span class="cm-operator">=</span> <span class="cm-variable">chunk_enc</span>[<span class="cm-variable">i</span><span class="cm-operator">++</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xor</span>(<span class="cm-variable">local_chunk</span>, <span class="cm-variable">iv</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ptr_state</span> <span class="cm-operator">=</span> <span class="cm-operator">&amp;</span><span class="cm-variable">state</span><span class="cm-operator">-&gt;</span><span class="cm-variable">field_0</span>[<span class="cm-number">16</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">state_end</span> <span class="cm-operator">=</span> <span class="cm-operator">&amp;</span><span class="cm-variable">state</span><span class="cm-operator">-&gt;</span><span class="cm-variable">field_0</span>[<span class="cm-number">160</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">do</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">sub_bytes</span>(<span class="cm-variable">local_chunk</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">shuffle_chunk_enc</span>(<span class="cm-variable">local_chunk</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtimes_crypt</span>(<span class="cm-variable">local_chunk</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ptr_state_</span> <span class="cm-operator">=</span> <span class="cm-variable">ptr_state</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ptr_state</span> <span class="cm-operator">+=</span> <span class="cm-number">16</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xor</span>(<span class="cm-variable">local_chunk</span>, <span class="cm-variable">ptr_state_</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">while</span> ( <span class="cm-variable">state_end</span> <span class="cm-operator">!=</span> <span class="cm-variable">ptr_state</span> );</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">sub_bytes</span>(<span class="cm-variable">local_chunk</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">shuffle_chunk_enc</span>(<span class="cm-variable">local_chunk</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xor</span>(<span class="cm-variable">local_chunk</span>, <span class="cm-variable">state_end</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> ( <span class="cm-variable">result</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>; <span class="cm-variable">result</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span>; <span class="cm-operator">++</span><span class="cm-variable">result</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">chunk_enc</span>[<span class="cm-variable">result</span>] <span class="cm-operator">=</span> <span class="cm-variable">local_chunk</span>[<span class="cm-variable">result</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">result</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable">__usercall</span> <span class="cm-variable">__spoils</span><span class="cm-operator">&lt;</span><span class="cm-variable">r8</span>,<span class="cm-variable">rax</span>,<span class="cm-variable">r9</span>,<span class="cm-variable">r10</span><span class="cm-operator">&gt;</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">inv_mix_sub_columns</span>(<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">a1@</span><span class="cm-operator">&lt;</span><span class="cm-variable">rcx</span><span class="cm-operator">&gt;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v1</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-operator">*</span><span class="cm-variable">a1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v3</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">2</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v4</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">3</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v4</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v3</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v2</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v4</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v3</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v2</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">2</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v4</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v3</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v2</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v5</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v6</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">4</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v7</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v2</span>] <span class="cm-variable">^</span> <span class="cm-variable">v5</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v8</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">5</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v9</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v3</span>] <span class="cm-variable">^</span> <span class="cm-variable">v7</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v10</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">6</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v11</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v4</span>] <span class="cm-variable">^</span> <span class="cm-variable">v9</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v12</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">7</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">3</span>] <span class="cm-operator">=</span> <span class="cm-variable">v11</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">4</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v12</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v10</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v8</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v6</span>];</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">5</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v12</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v10</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v8</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v6</span>];</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">6</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v12</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v10</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v8</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v6</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v13</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v6</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v14</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">8</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v15</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v8</span>] <span class="cm-variable">^</span> <span class="cm-variable">v13</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v16</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">9</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v17</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v10</span>] <span class="cm-variable">^</span> <span class="cm-variable">v15</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v18</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">10</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v19</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v12</span>] <span class="cm-variable">^</span> <span class="cm-variable">v17</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v20</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">11</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">7</span>] <span class="cm-operator">=</span> <span class="cm-variable">v19</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">8</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v20</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v18</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v16</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v14</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">9</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v20</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v18</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v16</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v14</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">10</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v20</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v18</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v16</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v14</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v21</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v14</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v22</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">12</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v23</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v16</span>] <span class="cm-variable">^</span> <span class="cm-variable">v21</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v24</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">13</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v25</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v18</span>] <span class="cm-variable">^</span> <span class="cm-variable">v23</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v26</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">14</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v27</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v20</span>] <span class="cm-variable">^</span> <span class="cm-variable">v25</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v28</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">a1</span>[<span class="cm-number">15</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">11</span>] <span class="cm-operator">=</span> <span class="cm-variable">v27</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">12</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v28</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v26</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v24</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v22</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">13</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v28</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v26</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v24</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v22</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v29</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v24</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v22</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v30</span> <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v26</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">14</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime11</span>[<span class="cm-variable">v28</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v26</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime9</span>[<span class="cm-variable">v24</span>] <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime13</span>[<span class="cm-variable">v22</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v31</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v32</span>[<span class="cm-number">15</span>] <span class="cm-operator">=</span> <span class="cm-variable">v29</span> <span class="cm-variable">^</span> <span class="cm-variable">v30</span> <span class="cm-variable">^</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xtime14</span>[<span class="cm-variable">v28</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">do</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">a1</span>[<span class="cm-variable">v31</span>] <span class="cm-operator">=</span> <span class="cm-variable">v32</span>[<span class="cm-variable">v31</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">++</span><span class="cm-variable">v31</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">while</span> ( <span class="cm-variable">v31</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span> );</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable">__usercall</span> <span class="cm-variable">__spoils</span><span class="cm-operator">&lt;</span><span class="cm-variable">rax</span>,<span class="cm-variable">rdx</span>,<span class="cm-variable">r8</span><span class="cm-operator">&gt;</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">rsub_bytes</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">buffer@</span><span class="cm-operator">&lt;</span><span class="cm-variable">rcx</span><span class="cm-operator">&gt;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">i</span>; <span class="cm-comment">// rax</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> ( <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>; <span class="cm-variable">i</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">buffer</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">rsbox</span>[(<span class="cm-variable-3">unsigned</span> <span class="cm-variable">__int8</span>)<span class="cm-variable">buffer</span>[<span class="cm-variable">i</span>]];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable">__usercall</span> <span class="cm-variable">__spoils</span><span class="cm-operator">&lt;</span><span class="cm-variable">rax</span>,<span class="cm-variable">rdx</span><span class="cm-operator">&gt;</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">shuffle_chunk_dec</span>(<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">a1@</span><span class="cm-operator">&lt;</span><span class="cm-variable">rcx</span><span class="cm-operator">&gt;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">i</span>; <span class="cm-comment">// rax</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">v2</span>[<span class="cm-number">24</span>]; <span class="cm-comment">// [rsp+0h] [rbp-18h]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">a1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">13</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">2</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">10</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">3</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">7</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">4</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">4</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">5</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">6</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">14</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">7</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">11</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">8</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">8</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">9</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">5</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">10</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">2</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">11</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">15</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">12</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">12</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">13</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">9</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">14</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">6</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">v2</span>[<span class="cm-number">15</span>] <span class="cm-operator">=</span> <span class="cm-variable">a1</span>[<span class="cm-number">3</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> ( <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>; <span class="cm-variable">i</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">a1</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">v2</span>[<span class="cm-variable">i</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">__int64</span> <span class="cm-variable">__fastcall</span> <span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">block_decrypt_cbc</span>(<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">crypt_buf</span>, <span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">key</span>, <span class="cm-variable">BR_CRYPT_BLOCKSTATE</span> <span class="cm-operator">*</span><span class="cm-variable">block_state</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">i</span>; <span class="cm-comment">// rax</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">v6</span>; <span class="cm-comment">// dl</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">state_skip_90</span>; <span class="cm-comment">// rdi</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">v8</span>; <span class="cm-comment">// rdx</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">__int64</span> <span class="cm-variable">result</span>; <span class="cm-comment">// rax</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">uint8_t</span> <span class="cm-variable">local_</span>[<span class="cm-number">16</span>]; <span class="cm-comment">// [rsp+20h] [rbp-38h] BYREF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> ( <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>; <span class="cm-variable">i</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span>; <span class="cm-variable">local_</span>[<span class="cm-variable">i</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">v6</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">v6</span> <span class="cm-operator">=</span> <span class="cm-variable">crypt_buf</span>[<span class="cm-variable">i</span><span class="cm-operator">++</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">state_skip_90</span> <span class="cm-operator">=</span> <span class="cm-operator">&amp;</span><span class="cm-variable">block_state</span><span class="cm-operator">-&gt;</span><span class="cm-variable">field_0</span>[<span class="cm-number">0x90</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xor</span>(<span class="cm-variable">local_</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">block_state</span><span class="cm-operator">-&gt;</span><span class="cm-variable">field_0</span>[<span class="cm-number">0xA0</span>]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">shuffle_chunk_dec</span>(<span class="cm-variable">local_</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">rsub_bytes</span>((<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span>)<span class="cm-variable">local_</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">do</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">v8</span> <span class="cm-operator">=</span> <span class="cm-variable">state_skip_90</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">state_skip_90</span> <span class="cm-operator">+=</span> <span class="cm-operator">-</span><span class="cm-number">0x10u</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xor</span>(<span class="cm-variable">local_</span>, <span class="cm-variable">v8</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">inv_mix_sub_columns</span>((<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span>)<span class="cm-variable">local_</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">shuffle_chunk_dec</span>(<span class="cm-variable">local_</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">rsub_bytes</span>((<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span>)<span class="cm-variable">local_</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">while</span> ( <span class="cm-variable">block_state</span> <span class="cm-operator">!=</span> (<span class="cm-variable">BR_CRYPT_BLOCKSTATE</span> <span class="cm-operator">*</span>)<span class="cm-variable">state_skip_90</span> );</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">br</span>::<span class="cm-variable">crypto</span>::<span class="cm-variable">cblock</span>::<span class="cm-variable">xor</span>(<span class="cm-variable">local_</span>, (<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span>)<span class="cm-variable">key</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> ( <span class="cm-variable">result</span> <span class="cm-operator">=</span> <span class="cm-number">0</span><span class="cm-variable">i64</span>; <span class="cm-variable">result</span> <span class="cm-operator">!=</span> <span class="cm-number">16</span>; <span class="cm-operator">++</span><span class="cm-variable">result</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">crypt_buf</span>[<span class="cm-variable">result</span>] <span class="cm-operator">=</span> <span class="cm-variable">local_</span>[<span class="cm-variable">result</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">result</span>;</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 6812px;"></div><div class="CodeMirror-gutters" style="display: none; height: 6812px;"></div></div></div></pre><h3><a name="functionalities-overview" class="md-header-anchor"></a><span>Functionalities overview</span></h3><p><span>The following commands are supported by Brute Ratel.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">download_file</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">add_privilege</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">list_applications</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dump_ipnet_table</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_current_dir</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clear_coffargs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clear_arg_string</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clear_child_string</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clear_parent</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">load_coff</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">copy_file</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">crisis_monitor</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dcsync</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">enable_dll_block</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">disable_dll_block</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dump_dns_cache_table</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">list_drivers</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clipboard_get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">query_file_info</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_threadex</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_args</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_env_strings</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_expiry_time</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">grab_token</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_idle_Time</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">impersonate_from_vault</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_network_info</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_active_tasks</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">get_ticket_from_spn</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">keylog</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pskill</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">query_ad</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_task_status</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">memsearch_perm</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">list_modules</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">list_tcp_listeners</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">inject</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lock_workstation</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nslookup</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ls</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">list_logical_drives</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lstree</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">impersonate_user</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">processdump_by_pid</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">memhook</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mkdir</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">movefile</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">do_group_user_query</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_udp_tcp_table</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">query_user_info</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">run_dll</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">phish_for_creds</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">run_child_with_spoofed_args_and_inject2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">port_scan</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pstree</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">enumerate_process_remote</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clear_import</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">write_file_and_start_service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">process_list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_import</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">inject_with_import</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pwd</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">enum_sessions_on_host</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">reg_query</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clear_vault</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">delete_file</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rmdir</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_ip_forward_table</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">run_child_with_spoofed_arg</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">run_child_with_spoofed_arg_suspended</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">run_as_user</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dump_sam_hive</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_task_cheduler_folder</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">screenshot</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">create_service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">delete_service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">shellexec_hijack_service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">list_services</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">start_service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_coffargs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_config_sleep_mode</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_threadex</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_creds_and_wmi_namespace_loc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_arg</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_child</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">try_get_debug_privilege</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_expiry_time</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_parent</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dump_process_by_name</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">netshares</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sharescan</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">load_dotnet_assembly</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">shellexecutea</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">inject_shellcode_into_pid</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">start_listener_smb_named_pipe</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">add_socks_profile</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">start_socks</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cancel_all_tasks</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">start_listener_tcp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_spoof_address</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_sleep_and_jitter</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">stop_task</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">swap_profile</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_sysinfo</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">impersonate_or_run_as_system</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_processes_and_threads</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">execute_command_n_times</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dump_token_vault</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upload</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_uptime</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_self_token_info</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clear_token_vault</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">remove_token_from_vault</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clear_wmi_namespace_and_creds</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wmi_exec_on_remote</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wmi_query</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_exit_flag_1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set_exit_flag_2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">list_windows</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print_sessions</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 3172px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3172px;"></div></div></div></pre><p><span>As the author of this post did not consult the brute ratel manual during the process of reverse engineering (except googling one to find out that &quot;CM&quot; stood for &quot;crisis-monitor&quot;), the naming represents the perspective of reverse engineering and likely differs from the perspective of a typical threat actor utilizing the malware.</span></p><h3><a name="copy-pastas-focaccia-lasagna-and-piccata" class="md-header-anchor"></a><span>Copy-pastas, focaccia, lasagna and piccata</span></h3><p><span>There are several commands in Brute Ratel that are interesting. The reasons for them being deemed interesting varies - sometimes it is because it is a paste of GPL2 code that violates the license, sometimes it is because of unique(ly bad) design choices.</span></p><p><span>The first is the minidump. It is pasted ReactOS code (GPL2). It is important to note that the pasting was done in a remarkably obtuse way.</span></p><p><img src="img\reactos1.png" referrerpolicy="no-referrer" alt="Decompiled Minidump vs Reactos Minidump"></p><p><span>The malware author modified this by changing MinidumpWriteDump to write only several hardcoded streams, and also by making the minidump implementation write to a transacted file instead of to a regular file.</span></p><p><img src="img\reactos2.png" referrerpolicy="no-referrer" alt="Transaction handling for minidump"></p><p><span>Those who do detection engineering can already see the detection opportunities afforded here, and those who do software development can already see the incredible level of incompetence shown by this approach to modifying pasted code.</span></p><p><span>Likewise, the DCSync code is also copypasted, albeit this time from </span><a href='
https://github.com/notsoshant/DCSyncer/blob/master/DCSyncer.c'><span>Github</span></a><span>.</span></p><p><img src="img\dcsync.png" referrerpolicy="no-referrer" alt="Transaction handling for minidump"></p><p><span>There is further copypaste of the AD Recon code, also from </span><a href='
https://github.com/outflanknl/Recon-AD/blob/master/Src/Recon-AD-Domain/Recon-AD-Domain/ReflectiveDll.cpp'><span>Github</span></a><span> this time.</span></p><p><img src="img\reconad.png" referrerpolicy="no-referrer" alt="Transaction handling for minidump"></p><p><span>There could be other locations that code are pasted that were not recognised.</span></p><p><span>The COFF Loader is a bog-standard copy-paste of the implementation by TrustedSec with slight modifications. This can be confirmed by looking at the tail end of the code.</span></p><p><img src="img\coff.png" referrerpolicy="no-referrer" alt="Decompiled COFF Loader cleanup - top: IDA decompilation of Brute Ratel, bottom: code from TrustedSec's repository"></p><p><span>Indeed, another licence violation - as far as this author is aware the condition that &quot;redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution&quot; was not met.</span></p><h3><a name="socks-proxy" class="md-header-anchor"></a><span>SOCKs proxy</span></h3><p><span>Brute ratel has a SOCKs proxy implementation. There is not much that is notable about this, other than that it can use an alternative profile for transmitting data as opposed to the primary communication profile.</span></p><p><img src="img\socks.png" referrerpolicy="no-referrer" alt="Decrypt-and-Encrypt for forwarding"></p><h3><a name="tcpsmb-listener" class="md-header-anchor"></a><span>TCP/SMB Listener</span></h3><p><span>Brute Ratel implements a TCP/SMB listener that forwards data from a pipe/socket back to the host. Strangely, the author designed it so that data is decrypted by the payload prior to sending to the C2. The likely reason is, as was suspected of many other design choices, a severe lack of critical thinking.</span></p><p><img src="img\forward.png" referrerpolicy="no-referrer" alt="Decrypt-and-Encrypt for forwarding"></p><h3><a name="sleep-encrypt" class="md-header-anchor"></a><span>Sleep-encrypt</span></h3><p><span>Sleep-encrypt has two mode, one we will call &quot;apc-driven&quot; and the other &quot;timer-driven&quot;. Both share the similarity of suspending a random thread and stealing its CONTEXT for the purpose of generating fake CONTEXT strugtures. A second thread has a series of APCs that sets the code to RW, encrypts it, applies this fake CONTEXT to the main thread, sleep, restores the CONTEXT, and then decrypt the code and set it back to RX. A pseudocode of the chain follows:</span></p><p><span>WaitForSingleObject(wait_event)</span>
<span>NtProtectVirtualMemory(rw)</span>
<span>CryptEncrypt(x)</span>
<span>GetContextThread(primary, backup_ctx)</span>
<span>SetContextThread(primary, cloned_ctx)</span>
<span>WaitForSingleObjectEx(wait_event, wait_time) //will time out when sleep is over</span>
<span>CryptDecrypt(x)</span>
<span>NtProtectVirtualMemory(rx)</span>
<span>SetContextThread(primary, backup_ctx)</span></p><p><span>The difference lies in the trigger method. The timer uses the pair of RtlCreateTimer/RtlRegisterWait to set this chain up and execute it, whereas the other utilises NtQueueApcThread to do so. Both take place inside a fiber.</span></p><p><img src="img\sleep.png" referrerpolicy="no-referrer" alt="Sleep logic"></p><h2><a name="detection-recommendation" class="md-header-anchor"></a><span>Detection recommendation</span></h2><p><span>The following section will be limited to basic immediately observable detections, as the author of the malware will likely read the post and tweak things based on the detection recommendations mentioned here.</span></p><h3><a name="network" class="md-header-anchor"></a><span>Network</span></h3><p><span>The DoH beaconing behaviour is easily detectable, the pattern is rather unique. This can be done using the information provided above.</span></p><h3><a name="endpoint" class="md-header-anchor"></a><span>Endpoint</span></h3><p><span>Various methods can be used to detect Brute Ratel from an endpoint perspective, however these will be left out to avoid the malware author from realising things that he could not have realised on his own. The </span><a href='#shameless-self-promotion-starts-here'><span>shameless self promotion section</span></a><span> has more on access to such information.</span></p><h2><a name="final-notes" class="md-header-anchor"></a><span>Final notes</span></h2><p><span>Those are the most notable implementation details one would find reverse engineering Brute Ratel. Overall, we find an unimaginatively copy-pasted mess, with fundamental knowledge one would expect a software engineer (let alone one who is security conscious) to have to be missing, not to mention basic concepts such as &quot;not breaking software licences&quot; to be missing. It is not atypical for malware developers to not pay attention to these as they focus only on their own bottom line and not much more, even when labelled &quot;legitimate red team&quot; offerings.</span></p><h4><a name="shameless-self-promotion-starts-here" class="md-header-anchor"></a><span>Shameless self promotion starts here</span></h4><p><span>For access to the fully labelled IDBs and code utilized in the process of reverse engineering Brute Ratel, join the </span><a href='https://discord.gg/tDKZZ6gHdP'><span>Discord server</span></a><span> and DM me for more information about subscription (yes, it is paid). Tired of doing reverse engineering for your job and want to offload it to someone who has the ability to stare at IDA Pro for 18 hours without standing up? We can arrange that too. You can also find me on </span><a href='http://twitter.com/boymoderRE'><span>Twitter</span></a><span> and get notifications of upcoming streams and new posts there. Are you a competitor of Brute Ratel who enjoyed watching your competition being ripped apart? You can be next too, don&#39;t fret, but you should subscribe to the Patreon anyways to support the work of an independent reverse engineer. Feel free as well to toss a coin to your boymoder @ bc1qen9sqx4c3tyuz90ucflh8tfs2ljmskh9x8zcht if the traditional finance system is not your cup of tea.</span></p></div>
</body>
</html>